# {{ cookiecutter.project_name }}

## 1. Git

Initialize:

```sh
git init
git remote add origin https://github.com/user/repo.git

git add .
git commit -m "Setup project"
git branch -M main
git push -u origin main
```

or clone:

```sh
git clone https://github.com/user/thisproject.git

git add .
git commit -m "Setup project"
git branch -M main
git push -u origin main
```

## 2. Local setup

Setup locally, on host (e.g. for VS Code) using `venv` module:

```sh
# Create .env.dev environment variables file based on .env.dev.example
# ...

cd server

# Create env using using python-3.10.0 (pyenv)
~/.pyenv/versions/3.10.0/bin/python -m venv .venv

# Activate virtual environment
source .venv/bin/activate

# Update pip and install development dependencies:
pip install -U pip
pip install wheel
pip install -r requirements/dev.txt
```

Start local server (after postgres container):

```sh
./manage.py runserver__plus
```

## 3. Docker

Create/start a compose:

```sh
# Build image, create containers and attach
docker compose -f compose.dev.yml up --build

docker compose -f compose.dev.yml up
```

Stop/remove a compose:

```sh
docker compose -f compose.dev.yml down
# or docker-compose -f compose.dev.yml stop

# Remove containers, networks, in-use images, dangling images, named volumes, anonymous volumes
docker compose -f compose.dev.yml down --rmi local \
    --volumes  # remove mounted volumes (eg. source code)
```

> To check, run: `docker container ls --all`, `docker network ls`,
> `docker image ls --all`, `docker volume ls`

## 4. Frontend

```sh
cd app

npm install
npm start
```

## Install a new package:

Locally:

```sh
pip install package

# Add `package==version` to requirements.txt
# ..
```

Docker:

```sh
docker compose -f compose.dev.yml down --rmi local
docker compose -f compose.dev.yml up --build
```

## Migrations

Make migrations:

```sh
# See if there are changes to the models
./manage.py makemigrations --dry-run

# Make migration files
./manage.py makemigrations
```

Apply all migrations:

```sh
# See if there are unapplied migrations
./manage.py showmigrations

./manage.py migrate
```

Un apply migrations to a particular app:

```sh
./manage.py migrate app zero
```

## Features

- docker compose
  - django local development
  - django container development
  - django container production
- admin interface
- swagger ui api docs
- postgres database
- pre-configured settings
- pre-defined users
- default global api throttling

## Configuration

All sensitive configuration settings should be specified through environment
variable fields (`.env.dev` and `.env.prod`).

## Server URLs

To get a complete list of all server URLs (admin routes + API endpoints) run
`./manage.py show_urls`.

## Registration

To turn registration on/off use boolean `DJANGO_ACCOUNT_ALLOW_REGISTRATION`
environment variable set in `.env.xxx` file.

## Administration

To create admin user run `./manage.py createsuperuser`.

Admin interface is served from `/admin/`.

## Documentation

OpenAPI 3.0 YAML schema is accessible from `/schema/` URL. Can be generated by
running `./manage.py spectacular --file schema.yml`.

Swagger UI is served from `/swagger/`.

## Testing

To execute tests run `pytest` in `server` folder if they are available.

## Development

In development either run django locally or containerized, both with postgres
inside of the container.

- For local change `DJANGO_READ_DOT_ENV_DEV` to `true` and `POSTGRES_HOST` to
  `localhost`.
- For container change `DJANGO_READ_DOT_ENV_DEV` to `false` and `POSTGRES_HOST`
  to `postgres`.

To start a server locally use:

```sh
./manage.py runserver_plus

# If you want to use HTTPs (self-signed certificate for development)
./manage.py runserver_plus --cert-file localhost
```

To execute commands inside django container run:

```sh
docker compose -f compose.dev.yml run --rm django bash

# E.g. usage
./manage.py shell_plus
```

The docker compose development setup is suitable for:

1. Writing code and testing

2. Deploying in development mode (trace errors)

## Production

Create `.env.prod` based on `.env.prod.example` in `server` folder. If you don't
need HTTPs then comment out security settings defined in `prod.py` file.

Run a production compose:

```sh
docker compose -f compose.prod.yml up --build
```

Run commands inside created django container:

```sh
docker compose -f compose.prod.yml run --rm django bash
```
